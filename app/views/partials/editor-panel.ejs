<!-- Editor Panel -->
<div class="editor-panel">
    <div v-if="!selectedWorkspace" class="welcome-screen">
        <h2>Welcome to <%= title %></h2>
        <p>Select a workspace from the sidebar or clone a repository to get started.<br/>
        Once connected, you'll have god-mode terminal access to your repositories.</p>
        <button @click="showRepositoriesModal = true" class="btn btn-icon">
            <i data-feather="git-branch"></i>
            Clone Your First Repository
        </button>
    </div>
    
    <template v-else>
        <!-- Tab bar for both modes, but content changes -->
        <div class="tab-bar">
            <!-- Show tabs in tab mode -->
            <template v-if="currentLayout === 'tabs'">
                <div v-for="tab in terminalTabs" 
                     :key="tab.sessionId"
                     :class="{ 'tab': true, 'active': activeTabId === tab.sessionId }"
                     @click="switchToTab(tab.sessionId)">
                    <i data-feather="terminal" class="icon"></i>
                    <span class="tab-name">{{ tab.sessionName }}</span>
                    <button v-if="terminalTabs.length > 1" 
                            class="tab-close" 
                            @click.stop="closeTab(tab.sessionId)"
                            title="Close tab">
                        <i data-feather="x" class="icon-small"></i>
                    </button>
                </div>
                <button class="tab-add" @click="createNewTab" title="New terminal tab">
                    <i data-feather="plus" class="icon-small"></i>
                </button>
            </template>
            
            <!-- Show pane info in split mode -->
            <template v-else>
                <div class="split-info">
                    <i data-feather="layout" class="icon"></i>
                    <span>{{ currentLayout.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase()) }} Layout</span>
                    <span class="pane-count">({{ panes.length }} panes)</span>
                </div>
                <button class="tab-add" @click="createNewTab" title="Add terminal session">
                    <i data-feather="plus" class="icon-small"></i>
                </button>
            </template>
            
            <!-- Split Controls (always visible) -->
            <div class="split-controls">
                <button class="split-btn" 
                        :class="{ active: currentLayout === 'tabs' }"
                        @click="convertLayout('tabs')"
                        title="Tabs layout">
                    <i data-feather="layers" class="icon"></i>
                </button>
                <button class="split-btn" 
                        :class="{ active: currentLayout === 'horizontal-split' }"
                        @click="convertLayout('horizontal-split')"
                        data-layout="horizontal-split"
                        title="Split horizontally">
                    <i data-feather="columns" class="icon"></i>
                </button>
                <button class="split-btn" 
                        :class="{ active: currentLayout === 'vertical-split' }"
                        @click="convertLayout('vertical-split')"
                        data-layout="vertical-split"
                        title="Split vertically">
                    <i data-feather="minus" class="icon" style="transform: rotate(90deg)"></i>
                </button>
                <button class="split-btn" 
                        :class="{ active: currentLayout === 'three-pane' }"
                        @click="convertLayout('three-pane')"
                        data-layout="three-pane"
                        title="Three-pane layout">
                    <i data-feather="sidebar" class="icon"></i>
                </button>
                <button class="split-btn" 
                        :class="{ active: currentLayout === 'grid-2x2' }"
                        @click="convertLayout('grid-2x2')"
                        data-layout="grid-2x2"
                        title="Grid layout">
                    <i data-feather="grid" class="icon"></i>
                </button>
            </div>
        </div>
        
        <div class="terminal-container" 
             :class="{ 
                'split-mode': currentLayout !== 'tabs',
                [`layout-${currentLayout}`]: currentLayout !== 'tabs'
             }">
            <!-- Tab Mode: Traditional single tab bar -->
            <template v-if="currentLayout === 'tabs'">
                <div v-for="tab in terminalTabs" 
                     :key="`terminal-${tab.sessionId}`"
                     :id="`terminal-${tab.sessionId}`" 
                     :class="{ 'terminal-wrapper': true, 'active': activeTabId === tab.sessionId }"
                     :style="{ display: activeTabId === tab.sessionId ? 'block' : 'none' }">
                </div>
            </template>
            
            <!-- Split Mode: IDE-style panes with individual tab bars -->
            <template v-else>
                <div v-for="pane in panes" 
                     :key="`pane-${pane.id}`"
                     :class="{ 'pane-container': true, 'active': activePaneId === pane.id }"
                     :style="{ gridArea: pane.gridArea }"
                     @click="focusPane(pane.id)">
                    
                    <!-- Pane Tab Bar -->
                    <div class="pane-tab-bar">
                        <!-- Tabs within this pane -->
                        <div v-for="tabId in pane.tabs" 
                             :key="`pane-tab-${pane.id}-${tabId}`"
                             :class="{ 'pane-tab': true, 'active': pane.activeTabId === tabId }"
                             :draggable="true"
                             @click.stop="switchToPaneTab(pane.id, tabId)"
                             @dragstart="startTabDrag(tabId, pane.id, $event)"
                             @dragend="endTabDrag">
                            <i data-feather="terminal" class="icon"></i>
                            <span class="tab-name">{{ getTabName(tabId) }}</span>
                            <button v-if="pane.tabs.length > 1" 
                                    class="tab-close" 
                                    @click.stop="removeTabFromPane(pane.id, tabId)"
                                    title="Close tab">
                                <i data-feather="x" class="icon-small"></i>
                            </button>
                        </div>
                        
                        <!-- Add tab button for this pane -->
                        <button class="pane-tab-add" 
                                @click.stop="addTabToPane(pane.id)" 
                                title="New terminal in this pane">
                            <i data-feather="plus" class="icon-small"></i>
                        </button>
                        
                        <!-- Pane controls -->
                        <div class="pane-controls">
                            <span class="pane-title">{{ pane.position }}</span>
                        </div>
                    </div>
                    
                    <!-- Terminal Container for Active Tab -->
                    <div class="pane-content"
                         @dragover.prevent
                         @dragenter.prevent  
                         @drop="handleTabDrop(pane.id, $event)">
                        <!-- Show only the active terminal for this pane -->
                        <div v-for="tabId in pane.tabs"
                             :key="`terminal-${tabId}`"
                             :id="`terminal-${tabId}`"
                             :class="{ 'terminal-wrapper': true, 'active': pane.activeTabId === tabId }"
                             :style="{ display: pane.activeTabId === tabId ? 'block' : 'none' }">
                        </div>
                        
                        <!-- Drop zone indicator -->
                        <div v-if="dragOverPane === pane.id" class="drop-zone-indicator">
                            <i data-feather="move" class="icon"></i>
                            <span>Drop tab here</span>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </template>
</div>